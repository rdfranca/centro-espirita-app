{% extends "base.html" %}
{% block content %}

    <h1 class="text-center mb-4">Relatório de Trabalhadores</h1>

    <!-- Filtros -->
    <div class="row mb-4 g-3" style="display: flex; flex-wrap: wrap;">
    <div class="col-md-4">
        <label for="filtroSetor">Setor:</label>
        <select id="filtroSetor" class="form-select"></select>
    </div>
    <div class="col-md-4">
        <label for="filtroFuncao">Função:</label>
        <select id="filtroFuncao" class="form-select"></select>
    </div>
    <div class="col-md-4">
        <label for="filtroTurno">Turno:</label>
        <select id="filtroTurno" class="form-select">
            <option value="">Todos</option>
            <option value="Manhã">Manhã</option>
            <option value="Tarde">Tarde</option>
            <option value="Noite">Noite</option>
        </select>
    </div>
</div>
   

    <!-- Tabela -->
    <table id="tabelaRelatorio" class="display nowrap" style="width:100%">
        <thead>
            <tr>
                <th>Nome</th>
                <th>CPF</th>
                <th>Celular</th>
                <th>Profissão</th>
                <th>Nascimento</th>
                <th>CEP</th>
                <th>Rua</th>
                <th>Número</th>
                <th>Bairro</th>
                <th>Cidade</th>
                <th>Estado</th>
                <th>Setor</th>
                <th>Função</th>
                <th>Turno</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<!-- Estilos e scripts do DataTables -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.3.6/css/buttons.dataTables.min.css">
<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.3.6/js/dataTables.buttons.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.3.6/js/buttons.html5.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/pdfmake.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/vfs_fonts.js"></script>

<script>
$(document).ready(function() {
    fetch('/api/relatorios')
        .then(res => res.json())
        .then(data => {
            const tabela = $('#tabelaRelatorio').DataTable({
                data: data,
                columns: [
                    { data: 'nome' },
                    { data: 'cpf' },
                    { data: 'celular' },
                    { data: 'profissao' },
                    { data: 'nascimento' },
                    { data: 'cep' },
                    { data: 'rua' },
                    { data: 'numero' },
                    { data: 'bairro' },
                    { data: 'cidade' },
                    { data: 'estado' },
                    { data: 'setor' },
                    { data: 'funcao' },
                    { data: 'turno' }
                ],
                dom: 'Bfrtip',
                buttons: [
                    'excelHtml5',
                    'pdfHtml5'
                ]
            });

            // Preencher filtros
            const setores = new Set();
            const funcoes = new Set();

            data.forEach(item => {
                setores.add(item.setor);
                funcoes.add(item.funcao);
            });

            setores.forEach(s => {
                $('#filtroSetor').append(`<option value="${s}">${s}</option>`);
            });

            funcoes.forEach(f => {
                $('#filtroFuncao').append(`<option value="${f}">${f}</option>`);
            });

            // Filtragem dinâmica
            $('#filtroSetor, #filtroFuncao, #filtroTurno').on('change', function () {
                const setor = $('#filtroSetor').val();
                const funcao = $('#filtroFuncao').val();
                const turno = $('#filtroTurno').val();

                tabela.columns(11).search(setor);
                tabela.columns(12).search(funcao);
                tabela.columns(13).search(turno);
                tabela.draw();
            });
        });
});
</script>
{% endblock %}